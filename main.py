<весь код с canvas вставляется сюда вручную — сокращено для примера>